import"./main.LIOLSP6D.js";import"./index.BNDFschD.js";import{_ as me,ag as L,u as ge,s as X,a as K,a0 as xe,a5 as he,d as ee,h as H,Z as P,aw as T,ax as N,l as M,$ as Ce,ay as we,a7 as Se,a6 as Pe,i as Te,b6 as Ne,b4 as oe,a4 as te,a1 as Oe,b7 as ae}from"./eo-dash.B_cHVYB2.js";import{i as Le}from"./easing-CH0-9wR8.CTB3jml5.js";import Me from"./EodashMapBtns-CaAGx7lk.Ra881wrd.js";import{f as O,ai as re,r as B,au as se,p as ce,a as W,o as Y,g as j,b as q,j as a,N as D,D as _e,q as ue,m as ke}from"./framework.DbRhnodN.js";import"./lit-element.Deg-YTNa.js";import"./WMTS.Dmm3w0JO.js";import"./Group.DfJ6KxFj.js";import"./extent.CajDHjk1.js";import"./GeoJSON.Br7Jz3X5.js";import"./index.DK02avya.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.C1Vj32jp.js";import"./WKT.CRW3-4HE.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.Bx-rtsOD.js";import"./ExportState-D3gfXAo3.C7_sw41Y.js";import"./PopUp-BMus90hz.DLRnqZEw.js";import"./VDialog-BgAHvaqZ.Cp1dXFTY.js";import"./forwardRefs-CswFzwtB.DgUT03a8.js";import"./transition-BDlIiv4N.yKVbKN_V.js";import"./index-Uv6dswg_.DtlJ1g1J.js";import"./VCard-VG0vOlKn.CZAuRAV4.js";import"./VImg-Clp3nrge.JBgARvuF.js";import"./EodashItemFilter-Dv3CAm7p.C5z9hitB.js";import"./handling-ChpkO_FF.CrPJotqq.js";import"./async-Cw0Rq6A5.DHmffHj3.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.BoorRBTK.js";import"./index.BUIxO2d3.js";const ie=async(e,o,u)=>{M.debug("Creating layers config",e,o,u);const r=[],s={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const d of o){let t;if(u){const i=typeof u=="string"?new Date(u):u;t=await d.createLayersJson(i)}else t=await d.createLayersJson(void 0);t.forEach(i=>{i.properties.layerControlExpand=!0,i.properties.layerControlToolsExpand=!0}),s.layers.push(...t)}r.push(s);const f=await ae.getIndicatorLayers(e),y=ae.getObservationPointsLayer(o);y&&s.layers.unshift(y);const n={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},b=f.filter(d=>d.properties.group==="baselayer");if(b.length){let d=0,t=0;for(let i=0;i<b.length;i++){const l=b[i];"visible"in l.properties||(l.properties.visible=!1),l.properties.visible&&(d++,t=i)}d===0&&(b[0].properties.visible=!0),d>0&&b.forEach((i,l)=>{l!==t?i.properties.visible=!1:i.properties.visible=!0}),n.layers.push(...b),n.layers.forEach(i=>{i.properties.layerControlExclusive=!0})}else n.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});n.layers.length&&r.push(n);const h={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},m=f.filter(d=>d.properties.group==="overlay");return m.length&&(h.layers.push(...m),r.unshift(h)),r};let U=null;const Be=(e,o)=>{const u=r=>{var n;const s=r.map,f=(n=e.value)==null?void 0:n.lonLatCenter,y=s==null?void 0:s.getView().getZoom();f&&!Number.isNaN(f[0])&&!Number.isNaN(f[1])&&!Number.isNaN(y)&&(o.value=[f[0],f[1],y])};ce(()=>{var r,s;(s=(r=e.value)==null?void 0:r.map)==null||s.on("moveend",u)}),ue(()=>{var r,s;(s=(r=e.value)==null?void 0:r.map)==null||s.un("moveend",u)})},ne=(e,o,u,r,s,f,y,n)=>{M.debug("InitMap",e.value,o.value,u.values,r.value);const h=ke(n?[o,r,n]:[o,r],async(m,d)=>{var C,F,J,Z,G,I,z,p,c,x,v,k,w,A,Q,E;const[t,i,l]=n?m:[m[0],m[1],null],[_,$,g]=n?d:[d[0],d[1],null];if(t){M.debug("Selected Indicator watch triggered",t,i),((C=e==null?void 0:e.value)==null?void 0:C.id)==="main"&&U!==null&&((F=e==null?void 0:e.value)==null||F.map.setView(U),U=null);let S=[];const de=(t==null?void 0:t.id)===(_==null?void 0:_.id)&&(i!==$||l&&(l==null?void 0:l.id)!==(g==null?void 0:g.id)),{selectedCompareStac:fe}=X(K());if(((J=e==null?void 0:e.value)==null?void 0:J.id)==="main"?await Ne(t):fe.value!==null&&(U=((Z=e==null?void 0:e.value)==null?void 0:Z.map.getView())??null,e.value.sync=f.value),de){S=await ie(t,u,l??i),M.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(S))),s.value=S,oe(((G=e.value)==null?void 0:G.id)==="compare"?"compareTime:updated":"time:updated",e.value,S);return}S=await ie(t,u,n?l:i);let V=null;const R=(z=(I=t==null?void 0:t.extent)==null?void 0:I.temporal)==null?void 0:z.interval;if(R&&R.length>0&&R[0].length>1&&(V=new Date(R[0][1]),M.debug("Indicator load: found stac extent, setting time to latest value",V)),!l&&V!==null&&V.toISOString()!==r.value&&!te.value&&(r.value=V.toISOString()),y&&!l&&((p=e==null?void 0:e.value)==null?void 0:p.id)==="main"&&(c=t.extent)!=null&&c.spatial.bbox&&!(te.value&&((x=L.value)!=null&&x[0])&&((v=L.value)!=null&&v[1]))){const ye=(k=t.extent)==null?void 0:k.spatial.bbox[0],ve=Oe([...ye]),be=(Q=e.value)==null?void 0:Q.transformExtent(ve,"EPSG:4326",(A=(w=e.value)==null?void 0:w.map)==null?void 0:A.getView().getProjection());e.value.zoomExtent=be}M.debug("Assigned layers",JSON.parse(JSON.stringify(S))),s.value=S,await oe(((E=e.value)==null?void 0:E.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,s.value)}},{immediate:!0});ue(()=>{h()})},le=(e,o)=>{Ce(async(u,r)=>{if(u.includes("compare"))return;const s=[];for(const f of e)s.push(...await f.getToolTipProperties());o.value=s,M.debug("Updated tooltip properties",o.value)})},je="#cursor-coordinates[data-v-fc8f0071]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media(max-width:959px){#cursor-coordinates[data-v-fc8f0071]{display:none}}#scale-line[data-v-fc8f0071]{position:fixed;left:24px;bottom:28px;color:#fff}@media(max-width:959px){#scale-line[data-v-fc8f0071]{bottom:102px}}[data-v-fc8f0071] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-fc8f0071] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-fc8f0071]{position:fixed;top:0;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-fc8f0071]>*{pointer-events:auto}",Ie=[".enabled"],ze=[".center",".zoom",".layers",".controls"],Ve=[".propertyTransform"],Fe=[".layers"],Je=[".propertyTransform"],Ze={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Ge={key:1,id:"scale-line",ref:"scale-line"};var pe;const Ae={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=L.value)==null?void 0:e[0])??15,((o=L.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((pe=L.value)==null?void 0:pe[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var z;const o=e,{width:u}=ge(),r=p=>{if(typeof p=="number")return p;if(typeof p=="string"){const c=p.split("/"),x=u.value;return x<960?parseInt(c[0])||1:x<1920?parseInt(c[1]||c[0])||1:parseInt(c[2]||c[1]||c[0])||1}return 1},s=O(()=>r(o.btnsPosition.x)),f=O(()=>r(o.btnsPosition.y)),y=O(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),n=re("scale-line"),b=re("cursor-coords"),h=B([]),m=B([]),d=O(()=>{const p={Attribution:{collapsible:!0}};return o.enableScaleLine&&n.value&&(p.ScaleLine={target:n.value}),o.enableCursorCoordinates&&b.value&&(p.MousePosition={projection:"EPSG:4326",coordinateFormat:c=>`${c[1].toFixed(3)} °N, ${c[0].toFixed(3)} °E`,target:b.value}),p}),t=se(o.center),i=se(((z=L.value)==null?void 0:z[2])??o.zoom),l=B([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),_=B([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),$={duration:1200,easing:Le},g=B(null),C=B(null),{selectedCompareStac:F}=X(K()),J=O(()=>o.enableCompare&&F.value?"":"first");Be(g,L),ce(()=>{const{selectedCompareStac:p,selectedStac:c,selectedItem:x}=X(K());xe.value=g.value,o.enableCompare&&(he.value=C.value),o.enableCompare&&(ne(C,p,Te,ee,_,g,!1),le(H,m)),ne(g,c,H,ee,l,C,o.zoomToExtent,x)}),le(H,h);const Z=O(()=>({visibility:h.value.length?"visible":"hidden"})),G=O(()=>({visibility:m.value.length?"visible":"hidden"})),I=p=>{const c=p==="main"?h:m,x=p=="main"?Se:Pe;return v=>{const k=JSON.parse(we.render(JSON.stringify(c.value),{...x.value??{}})),w=k==null?void 0:k.find(A=>A.id===v.key);if(w)return typeof v.value=="object"&&(v.value=JSON.stringify(v.value)),isNaN(Number(v.value))||(v.value=Number(v.value).toFixed(4).toString()),{key:w.title||w.id,value:v.value+" "+(w.appendix||"")}}};return(p,c)=>(Y(),W("span",null,[j("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":J.value},[j("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:g,id:"main",".animationOptions":$,".center":a(t),".zoom":a(i),".layers":l.value,".controls":d.value},[j("eox-map-tooltip",{style:D(Z.value),".propertyTransform":I("main")},null,44,Ve)],40,ze),j("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:C,".layers":_.value},[j("eox-map-tooltip",{style:D(G.value),".propertyTransform":I("compare")},null,44,Je)],40,Fe)],40,Ie),e.enableCursorCoordinates?(Y(),W("div",Ze,null,512)):q("v-if",!0),e.enableScaleLine?(Y(),W("span",Ge,null,512)):q("v-if",!0),j("div",{class:"map-buttons-container",style:D(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0`)},[q(" prettier-ignore "),_e(Me,{style:D({gridColumn:a(P)||a(T)||a(N)?s.value:"12",gridRow:f.value}),exportMap:a(P)||a(T)||a(N)?y.value.exportMap:!1,changeProjection:a(P)||a(T)||a(N)?y.value.changeProjection:!1,compareIndicators:a(P)||a(T)||a(N)?y.value.compareIndicators:!1,backToPOIs:a(P)||a(T)||a(N)?y.value.backToPOIs:!1,enableSearch:a(P)||a(T)||a(N)?y.value.enableSearch:!1,enableZoom:a(P)||a(T)||a(N)?y.value.enableZoom:!1},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])],4)]))}},wo=me(Ae,[["styles",[je]],["__scopeId","data-v-fc8f0071"]]);export{wo as default};
