import"./main.iuhFMc7Q.js";import"./main.Bv6zFC33.js";import"./main.D3fL5J-K.js";import{_ as z,ai as F,u as R,ax as M,au as U,l as q,i as G,h as H,bl as Q,ak as O,bm as W,at as X,bn as Y,d as Z,e as $}from"./eo-dash.QK8MdXBx.js";import{c as E,j as ee,P as ae}from"./ProcessList-D29NuAtl.kspXr_f8.js";import oe from"./EodashChart-B5HMwpIC.DDmwY8Sk.js";import{i as w,u as te,h as se}from"./handling-CgvBj-yu.0kSCF5Xj.js";import{r as m,ah as re,f as x,a as S,o as f,D as ne,b as y,c as k,g as ie,j as b,w as _,I as A,p as J,aD as ce,m as D,P as le}from"./framework.B074baPX.js";import{g as ue,f as pe,n as de}from"./async-igcVPy2t.Chmslv40.js";import"./lit-element.L04JKUcP.js";import"./addCommonStyleSheet.zOcQQLUh.js";import"./sequential.BcvVcPN9.js";import"./orient2d.DArCjZZA.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.ivFt-JzS.js";import"./when.BR7zwNJC.js";import"./getElement.CdRlZPdn.js";import"./GeoJSON.Bn398gYN.js";import"./extent.B6zYA2nd.js";import"./WKT.C5Hr-LXE.js";import"./browser.COpcbqT-.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.BJtOAKhC.js";import"./index.CxojoGlr.js";import"./index.BIJR-IiI.js";import"./item.Bx-rtsOD.js";import"./index-CJnd5pu_.s-38Jlbl.js";import"./VTooltip-DXGiC0z0.BpI6CfPk.js";import"./forwardRefs-DI6nWPjT.C3-qpdwA.js";import"./transition-D2dTlwaf.4pd8Sd7A.js";const me=({selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,processResults:c,loading:l,isPolling:u,mapElement:e})=>{const i=ce(Y);J(async()=>{((e==null?void 0:e.layers.length)??0)>1?await w({enableCompare:(e==null?void 0:e.id)==="compare",selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,processResults:c,loading:l,isPolling:u}):i.once(async()=>{await w({enableCompare:(e==null?void 0:e.id)==="compare",selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,loading:l,processResults:c,isPolling:u})})});const h=(e==null?void 0:e.id)==="compare"?"compareLayers:updated":"layers:updated";X(async(p,g)=>{(p=="layertime:updated"||p=="compareLayertime:updated"||p=="time:updated"||p=="compareTime:updated")&&await te({jsonformSchema:s.value,newLayers:g}),p===h&&await w({enableCompare:(e==null?void 0:e.id)==="compare",selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,processResults:c,loading:l,isPolling:u})})};function fe(o,n,s,r){const c=async e=>{await r()},l=async()=>{await le(()=>{var e;(e=n.value)==null||e.addEventListener("change",c)})},u=()=>{var e;(e=n.value)==null||e.removeEventListener("change",c)};D(s,e=>{var i;o.value=((i=e==null?void 0:e.options)==null?void 0:i.execute)||!1}),J(()=>{D(o,async e=>{e?await l():u()},{immediate:!0})})}const ve="eox-jsonform{padding:.7em;min-height:0px}",ye={ref:"container",class:"py-1"},be=[".schema"],he={class:"text-right"},ge={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(o){const n=m(!1),s=m(null),r=re("jsonformEl"),c=x(()=>{var a;return(a=p.value)==null?void 0:a.links.filter(t=>t.endpoint==="eoxhub_workspaces").length}),l=m(!1),u=m(!1),e=m(!1),i=m([]),h=x(()=>!u.value&&!!s.value&&!!r.value),{selectedStac:p,selectedCompareStac:g}=F(R()),C=o.enableCompare?g:p,v=o.enableCompare?M:U,L=o.enableCompare?q:G,j=o.enableCompare?E:ee,N=x(()=>{var a;return L.value+((a=v.value)==null?void 0:a.id)});me({selectedStac:C,mapElement:v.value,jsonformEl:r,jsonformSchema:s,isProcessed:n,processResults:i,loading:l,isPolling:e});const V=()=>{i.value.forEach(a=>{var d;if(!a)return;let t="";typeof a=="string"?(t=a.includes("/")?a.split("/").pop()??"":a,t=t.includes("?")?t.split("?")[0]:t):t=((d=C.value)==null?void 0:d.id)+"_process_results.json",de(t,a)})},B=async()=>{var P,T,I;const a=ue(s.value);if(a&&Array.isArray((P=r.value)==null?void 0:P.value[a])&&!((T=r.value)!=null&&T.value[a].length)){n.value=!1;const K=o.enableCompare?Z:$;K.value=null;return}const d=(I=r.value)==null?void 0:I.editor.validate();if(d!=null&&d.length){console.warn("[eodash] Form validation failed",d);return}i.value=[],await se({jobs:j,selectedStac:C,jsonformEl:r,jsonformSchema:s,loading:l,isPolling:e,processResults:i,mapElement:v.value}),n.value=!0,c.value&&pe(j,L.value)};return fe(u,r,s,B),(a,t)=>(f(),S("div",ye,[ne(ae,{"map-element":b(v),"enable-compare":o.enableCompare},null,8,["map-element","enable-compare"]),s.value?(f(),S("eox-jsonform",{key:N.value,ref_key:"jsonformEl",ref:r,".schema":s.value},null,40,be)):y("v-if",!0),b(H)?y("v-if",!0):(f(),k(oe,{key:1,"vega-embed-options":o.vegaEmbedOptions,"enable-compare":o.enableCompare},null,8,["vega-embed-options","enable-compare"])),ie("div",he,[h.value?(f(),k(O,{key:0,loading:l.value,style:{"margin-right":"8px"},"append-icon":[b(Q)],onClick:B,density:"comfortable",size:"small"},{default:_(()=>[...t[0]||(t[0]=[A(" Execute ",-1)])]),_:1},8,["loading","append-icon"])):y("v-if",!0),i.value.length&&n.value&&!c.value?(f(),k(O,{key:1,color:"primary",style:{"margin-right":"8px"},"append-icon":[b(W)],onClick:V,size:"small",density:"comfortable"},{default:_(()=>[...t[1]||(t[1]=[A(" Download ",-1)])]),_:1},8,["append-icon"])):y("v-if",!0)])],512))}},Ze=z(ge,[["styles",[ve]]]);export{Ze as default};
