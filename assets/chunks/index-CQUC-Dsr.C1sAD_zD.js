import{s as X,a as Y,k as Z,n as E,L as ee,M as ae,N as te,V as M,O as oe,t as se,P as ne}from"./eo-dash.Ci4b1nQa.js";import{c as re,j as le,_ as ie}from"./ProcessList-BSNOH4gn.D3rOPRrk.js";import{o as K,i as x,h as ce}from"./handling-KOYEogQg.C_y7DNmf.js";import{p as v,aM as R,h as g,c as _,o as y,G as ue,e as C,j as de,k as m,N as ve,ak as F,b as H,w as S,a as q,v as G,aD as pe,q as z,P as fe}from"./framework.CGrlUVaT.js";import{u as ye,d as me}from"./async-D_BfpXgS.DexJnjPq.js";import"./commonjsHelpers.BosuxZz1.js";import"./index-Df44DH79.Bl2_rPVZ.js";import"./VTooltip-DhUcyxPu.BPU6e1fC.js";import"./VOverlay-Ddm_9SBp.B3YM6kSu.js";import"./forwardRefs-CaZFbTfA.CUR4ER3j.js";import"./transition-CZdy2yvn.Crjxe2yi.js";import"./utils.KQWJcE3U.js";import"./index.KH_2m63C.js";const he=({selectedStac:l,jsonformEl:n,jsonformSchema:c,chartSpec:i,isProcessed:r,processResults:s,loading:u,isPolling:t,mapElement:a})=>{const h=pe(ne);G(async()=>{((a==null?void 0:a.layers.length)??0)>1?await x({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:l,jsonformEl:n,jsonformSchema:c,chartSpec:i,isProcessed:r,processResults:s,loading:u,isPolling:t}):h.once(async()=>{await x({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:l,jsonformEl:n,jsonformSchema:c,chartSpec:i,isProcessed:r,loading:u,processResults:s,isPolling:t})})});const b=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";se(async(p,B)=>{p===b&&await x({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:l,jsonformEl:n,jsonformSchema:c,chartSpec:i,isProcessed:r,processResults:s,loading:u,isPolling:t})})};function be(l,n,c,i){const r=async t=>{await i()},s=async()=>{await fe(()=>{var t;(t=n.value)==null||t.addEventListener("change",r)})},u=()=>{var t;(t=n.value)==null||t.removeEventListener("change",r)};z(c,t=>{var a;l.value=((a=t==null?void 0:t.options)==null?void 0:a.execute)||!1}),G(()=>{z(l,async t=>{t?await s():u()},{immediate:!0})})}const we={ref:"container",class:"pb-4"},ge=[".schema"],Ce=[".spec",".dataValues",".opt"],ke={class:"mt-4 text-right"},Je={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(l){const n=v(null),c=v(null),i=v(!1),r=v(null),s=R("jsonformEl"),u=g(()=>{var o;return(o=L.value)==null?void 0:o.links.filter(e=>e.endpoint==="eoxhub_workspaces").length}),t=R("container"),a=v(!1),h=v(!1),b=v(!1),p=v([]),B=g(()=>!h.value&&(!!r.value||!!n.value)&&!!s.value),{selectedStac:L,selectedCompareStac:U}=X(Y()),k=l.enableCompare?U:L,w=l.enableCompare?Z:E,P=l.enableCompare?ee:ae,T=l.enableCompare?re:le,$=g(()=>{var o;return P.value+((o=w.value)==null?void 0:o.id)});he({selectedStac:k,mapElement:w.value,jsonformEl:s,jsonformSchema:r,chartSpec:n,isProcessed:i,processResults:p,loading:a,isPolling:b});const Q=()=>{p.value.forEach(o=>{var d;if(!o)return;let e="";typeof o=="string"?(e=o.includes("/")?o.split("/").pop()??"":o,e=e.includes("?")?e.split("?")[0]:e):e=((d=k.value)==null?void 0:d.id)+"_process_results.json",me(e,o)})},V=async()=>{var N,O,j;const e=(D=>{var A,I;for(const J in D.properties)if((I=(A=D.properties[J])==null?void 0:A.options)!=null&&I.drawtools)return J})(r.value);if(e&&Array.isArray((N=s.value)==null?void 0:N.value[e])&&!((O=s.value)!=null&&O.value[e].length)){i.value=!1,n.value=null;return}const f=(j=s.value)==null?void 0:j.editor.validate();if(f!=null&&f.length){console.warn("[eodash] Form validation failed",f);return}p.value=[],await ce({jobs:T,selectedStac:k,jsonformEl:s,jsonformSchema:r,chartSpec:n,chartData:c,loading:a,isPolling:b,processResults:p,mapElement:w.value}),i.value=!0,u.value&&ye(T,P.value)};be(h,s,r,V);const W=g(()=>{var e,d,f;const o={};return(e=n.value)!=null&&e.height||(o.height=Math.max((((d=t.value)==null?void 0:d.offsetHeight)??0)-(((f=s.value)==null?void 0:f.offsetHeight)??0),200)+"px"),o});return(o,e)=>(y(),_("div",we,[ue(ie,{"map-element":m(w),"enable-compare":l.enableCompare},null,8,["map-element","enable-compare"]),r.value?(y(),_("eox-jsonform",{key:$.value,ref_key:"jsonformEl",ref:s,".schema":r.value},null,40,ge)):C("v-if",!0),i.value&&n.value?(y(),_("eox-chart",{key:1,class:"chart",".spec":F(n.value),".dataValues":F(c.value),"onClick:item":e[0]||(e[0]=(...d)=>m(K)&&m(K)(...d)),style:ve(W.value),".opt":l.vegaEmbedOptions},null,44,Ce)):C("v-if",!0),de("div",ke,[B.value?(y(),H(M,{key:0,loading:a.value,style:{"margin-right":"20px"},"append-icon":[m(te)],onClick:V,color:"primary"},{default:S(()=>e[1]||(e[1]=[q(" Execute ")])),_:1,__:[1]},8,["loading","append-icon"])):C("v-if",!0),p.value.length&&i.value&&!u.value?(y(),H(M,{key:1,color:"primary","append-icon":[m(oe)],onClick:Q},{default:S(()=>e[2]||(e[2]=[q(" Download ")])),_:1,__:[2]},8,["append-icon"])):C("v-if",!0)])],512))}};export{Je as default};
