import"./main.QcBeP3b0.js";import"./index.0z8M0T9I.js";import{_ as me,ag as _,u as ge,s as E,a as ee,a0 as xe,a5 as he,d as te,h as W,b6 as Ce,Z as T,aw as N,ax as O,l as k,$ as Se,ay as we,a7 as Pe,a6 as Te,i as Ne,b7 as Oe,b4 as ae,a4 as Y,a1 as Le,b8 as re}from"./eo-dash.D5jBs-l4.js";import{i as Me}from"./easing-CH0-9wR8.CTB3jml5.js";import _e from"./EodashMapBtns-DmCb7SNH.B1NFfeuA.js";import{f as L,ai as se,r as M,au as ie,p as oe,a as X,o as K,g as z,b as Q,j as r,N as D,D as ke,q as ue,m as Be}from"./framework.CkvEjYlt.js";import"./lit-element.Deg-YTNa.js";import"./WMTS.RT2X-Ydu.js";import"./Group.DfJ6KxFj.js";import"./extent.CajDHjk1.js";import"./GeoJSON.BZT5TuW2.js";import"./index.DK02avya.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.CFLWhcph.js";import"./WKT.CT1EjoBW.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.Bx-rtsOD.js";import"./ExportState-0dvIQwmb.LBMbhjI1.js";import"./PopUp-LrkE4MkK.BtCz3ftL.js";import"./VDialog-D73GcYUR.ClwEzYB0.js";import"./forwardRefs-BbP5WC4B.oSLN9T0k.js";import"./transition-r1LrUSuA.D16dg2Mi.js";import"./index-BBCA2tGP.OsDOFZYT.js";import"./VCard-BBnlqHrE.DiFXkuAy.js";import"./VImg-BQPz0BfJ.CfVlwmBp.js";import"./EodashItemFilter-CzGdHNn9.96UwaAry.js";import"./handling-DQzPvgeC.CKdpM472.js";import"./async-CNU9BZFR.DmWMy-qW.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.BoorRBTK.js";import"./index.BUIxO2d3.js";const ne=async(e,o,c)=>{k.debug("Creating layers config",e,o,c);const t=[],s={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const d of o){let a;if(c){const i=typeof c=="string"?new Date(c):c;a=await d.createLayersJson(i)}else a=await d.createLayersJson(void 0);a.forEach(i=>{i.properties.layerControlExpand=!0,i.properties.layerControlToolsExpand=!0}),s.layers.push(...a)}t.push(s);const f=await re.getIndicatorLayers(e),y=re.getObservationPointsLayer(o);y&&s.layers.unshift(y);const u={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},b=f.filter(d=>d.properties.group==="baselayer");if(b.length){let d=0,a=0;for(let i=0;i<b.length;i++){const l=b[i];"visible"in l.properties||(l.properties.visible=!1),l.properties.visible&&(d++,a=i)}d===0&&(b[0].properties.visible=!0),d>0&&b.forEach((i,l)=>{l!==a?i.properties.visible=!1:i.properties.visible=!0}),u.layers.push(...b),u.layers.forEach(i=>{i.properties.layerControlExclusive=!0})}else u.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});u.layers.length&&t.push(u);const C={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},m=f.filter(d=>d.properties.group==="overlay");return m.length&&(C.layers.push(...m),t.unshift(C)),t};let q=null;const Ie=(e,o)=>{const c=t=>{var u;const s=t.map,f=(u=e.value)==null?void 0:u.lonLatCenter,y=s==null?void 0:s.getView().getZoom();f&&!Number.isNaN(f[0])&&!Number.isNaN(f[1])&&!Number.isNaN(y)&&(o.value=[f[0],f[1],y])};oe(()=>{var t,s;(s=(t=e.value)==null?void 0:t.map)==null||s.on("moveend",c)}),ue(()=>{var t,s;(s=(t=e.value)==null?void 0:t.map)==null||s.un("moveend",c)})},le=(e,o,c,t,s,f,y,u)=>{k.debug("InitMap",e.value,o.value,c.values,t.value);const C=Be(u?[o,t,u]:[o,t],async(m,d)=>{var S,R,Z,G,A,V,$,F,J,n,p,x,v,I,h,j;const[a,i,l]=u?m:[m[0],m[1],null],[B,H,g]=u?d:[d[0],d[1],null];if(a){k.debug("Selected Indicator watch triggered",a,i),((S=e==null?void 0:e.value)==null?void 0:S.id)==="main"&&q!==null&&((R=e==null?void 0:e.value)==null||R.map.setView(q),q=null);let w=[];const de=(a==null?void 0:a.id)===(B==null?void 0:B.id)&&(i!==H||l&&(l==null?void 0:l.id)!==(g==null?void 0:g.id)),{selectedCompareStac:fe}=E(ee());if(((Z=e==null?void 0:e.value)==null?void 0:Z.id)==="main"?await Oe(a):fe.value!==null&&(q=((G=e==null?void 0:e.value)==null?void 0:G.map.getView())??null,e.value.sync=f.value),de){w=await ne(a,c,l??i),k.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(w))),s.value=w,ae(((A=e.value)==null?void 0:A.id)==="compare"?"compareTime:updated":"time:updated",e.value,w);return}let P=null;const U=($=(V=a==null?void 0:a.extent)==null?void 0:V.temporal)==null?void 0:$.interval;if(U&&U.length>0&&U[0].length>1&&(P=new Date(U[0][1]),k.debug("Indicator load: found stac extent, setting time to latest value",P)),(!l&&P!==null&&P.toISOString()!==t.value&&!Y.value||Y.value&&!t.value&&P)&&(t.value=P.toISOString()),w=await ne(a,c,l??i),y&&!l&&((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"&&(J=a.extent)!=null&&J.spatial.bbox&&!(Y.value&&((n=_.value)!=null&&n[0])&&((p=_.value)!=null&&p[1]))){const ye=(x=a.extent)==null?void 0:x.spatial.bbox[0],ve=Le([...ye]),be=(h=e.value)==null?void 0:h.transformExtent(ve,"EPSG:4326",(I=(v=e.value)==null?void 0:v.map)==null?void 0:I.getView().getProjection());e.value.zoomExtent=be}k.debug("Assigned layers",JSON.parse(JSON.stringify(w))),s.value=w,await ae(((j=e.value)==null?void 0:j.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,s.value)}},{immediate:!0});ue(()=>{C()})},pe=(e,o)=>{Se(async(c,t)=>{if(c.includes("compare"))return;const s=[];for(const f of e)s.push(...await f.getToolTipProperties());o.value=s,k.debug("Updated tooltip properties",o.value)})},je="#cursor-coordinates[data-v-76f918a2]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media(max-width:959px){#cursor-coordinates[data-v-76f918a2]{display:none}}#scale-line[data-v-76f918a2]{position:fixed;left:24px;bottom:28px;color:#fff}@media(max-width:959px){#scale-line[data-v-76f918a2]{bottom:102px}}[data-v-76f918a2] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-76f918a2] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-76f918a2]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-76f918a2]>*{pointer-events:auto}",ze=[".enabled"],Ve=[".center",".zoom",".layers",".controls"],Fe=[".propertyTransform"],Je=[".layers"],Re=[".propertyTransform"],Ze={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Ge={key:1,id:"scale-line",ref:"scale-line"};var ce;const Ae={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=_.value)==null?void 0:e[0])??15,((o=_.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((ce=_.value)==null?void 0:ce[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var J;const o=e,{width:c}=ge(),t=n=>{if(typeof n=="number")return n;if(typeof n=="string"){const p=n.split("/"),x=c.value;return x<960?parseInt(p[0])||1:x<1920?parseInt(p[1]||p[0])||1:parseInt(p[2]||p[1]||p[0])||1}return 1},s=L(()=>t(o.btnsPosition.x)),f=L(()=>t(o.btnsPosition.y)),y=L(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),u=se("scale-line"),b=se("cursor-coords"),C=M([]),m=M([]),d=L(()=>{const n={Attribution:{collapsible:!0}};return o.enableScaleLine&&u.value&&(n.ScaleLine={target:u.value}),o.enableCursorCoordinates&&b.value&&(n.MousePosition={projection:"EPSG:4326",coordinateFormat:p=>`${p[1].toFixed(3)} °N, ${p[0].toFixed(3)} °E`,target:b.value}),n}),a=ie(o.center),i=ie(((J=_.value)==null?void 0:J[2])??o.zoom),l=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),B=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),H={duration:1200,easing:Me},g=M(null),S=M(null),{selectedCompareStac:R}=E(ee()),Z=L(()=>o.enableCompare&&R.value?"":"first");Ie(g,_),oe(()=>{const{selectedCompareStac:n,selectedStac:p,selectedItem:x}=E(ee());xe.value=g.value,o.enableCompare&&(he.value=S.value),o.enableCompare&&(le(S,n,Ne,te,B,g,!1),pe(W,m)),le(g,p,W,te,l,S,o.zoomToExtent,x)}),pe(W,C);const G=L(()=>({visibility:C.value.length?"visible":"hidden"})),A=L(()=>({visibility:m.value.length?"visible":"hidden"})),V=n=>{const p=n==="main"?C:m,x=n=="main"?Pe:Te;return v=>{const I=JSON.parse(we.render(JSON.stringify(p.value),{...x.value??{}})),h=I==null?void 0:I.find(j=>j.id===v.key);if(h){if(typeof v.value=="object"&&(v.value=JSON.stringify(v.value)),!isNaN(Number(v.value))){const j=isNaN(Number(h.decimals))?4:Number(h.decimals);v.value=Number(v.value).toFixed(j).toString()}return{key:h.title||h.id,value:v.value+" "+(h.appendix||"")}}}},{mainRect:$}=Ce(),F=M(0);return oe(()=>{const n=document.querySelector("eo-dash");F.value=($.value.top||(n==null?void 0:n.getBoundingClientRect().top))??0}),(n,p)=>(K(),X("span",null,[z("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":Z.value},[z("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:g,id:"main",".animationOptions":H,".center":r(a),".zoom":r(i),".layers":l.value,".controls":d.value},[z("eox-map-tooltip",{style:D(G.value),".propertyTransform":V("main")},null,44,Fe)],40,Ve),z("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:S,".layers":B.value},[z("eox-map-tooltip",{style:D(A.value),".propertyTransform":V("compare")},null,44,Re)],40,Je)],40,ze),e.enableCursorCoordinates?(K(),X("div",Ze,null,512)):Q("v-if",!0),e.enableScaleLine?(K(),X("span",Ge,null,512)):Q("v-if",!0),z("div",{class:"map-buttons-container",style:D(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0; top: ${F.value}px;`)},[Q(" prettier-ignore "),ke(_e,{style:D({gridColumn:r(T)||r(N)||r(O)?s.value:"12",gridRow:f.value}),exportMap:r(T)||r(N)||r(O)?y.value.exportMap:!1,changeProjection:r(T)||r(N)||r(O)?y.value.changeProjection:!1,compareIndicators:r(T)||r(N)||r(O)?y.value.compareIndicators:!1,backToPOIs:r(T)||r(N)||r(O)?y.value.backToPOIs:!1,enableSearch:r(T)||r(N)||r(O)?y.value.enableSearch:!1,enableZoom:r(T)||r(N)||r(O)?y.value.enableZoom:!1},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])],4)]))}},wo=me(Ae,[["styles",[je]],["__scopeId","data-v-76f918a2"]]);export{wo as default};
