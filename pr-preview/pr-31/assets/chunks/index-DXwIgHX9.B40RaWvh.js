import"./main.WbP_F8hp.js";import"./main.CeBfC6bG.js";import"./main.tEBobVwU.js";import{_ as W,s as X,a as Y,a5 as ee,a0 as ae,aw as te,Z as oe,bb as se,V as E,bc as re,$ as ne,bd as ie,be as le,bf as ce}from"./eo-dash.DYR-K-T6.js";import{c as ue,j as pe,P as de}from"./ProcessList-_eB2TCX4.OwfTu8Vi.js";import{o as F,i as _,h as ve}from"./handling-ChpkO_FF.lZs66tOF.js";import{r as d,ai as P,f as C,m as L,a as B,o as y,D as fe,b as w,g as me,j as h,N as ye,au as H,c as M,w as S,I as z,p as U,aD as he,P as be}from"./framework.BRrkP1Hi.js";import{d as ge,m as xe}from"./async-Cw0Rq6A5.DUiizlnW.js";import"./lit-element.Deg-YTNa.js";import"./addCommonStyleSheet.CDj2GsfV.js";import"./sequential.BHUe01AH.js";import"./orient2d.DArCjZZA.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.oNa9w_hR.js";import"./when.BR7zwNJC.js";import"./getElement.CdRlZPdn.js";import"./GeoJSON.Br7Jz3X5.js";import"./extent.CajDHjk1.js";import"./WKT.CRW3-4HE.js";import"./browser.COpcbqT-.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./index.DCVKSTf4.js";import"./item.Bx-rtsOD.js";import"./index-BqiJmKuZ.BI1A3nhD.js";import"./VTooltip-BaIIC1sK.QesSy5Bp.js";import"./forwardRefs-CswFzwtB.CZa_p7Jz.js";import"./transition-BDlIiv4N.CxFNLzY9.js";const Ce=({selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o,mapElement:a})=>{const m=he(ie);U(async()=>{((a==null?void 0:a.layers.length)??0)>1?await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o}):m.once(async()=>{await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,loading:u,processResults:s,isPolling:o})})});const b=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";ne(async(g,f)=>{g===b&&await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o})})};function we(r,n,c,l){const i=async o=>{await l()},s=async()=>{await be(()=>{var o;(o=n.value)==null||o.addEventListener("change",i)})},u=()=>{var o;(o=n.value)==null||o.removeEventListener("change",i)};L(c,o=>{var a;r.value=((a=o==null?void 0:o.options)==null?void 0:a.execute)||!1}),U(()=>{L(r,async o=>{o?await s():u()},{immediate:!0})})}const ke="eox-chart{--background-color: transparent;padding-top:1em}eox-jsonform{padding:.7em;min-height:0px}",_e={ref:"container",class:"pb-4"},Pe=[".schema"],Be=[".spec",".dataValues",".opt"],Le={class:"mt-4 text-right"},Te={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(r){const n=d(null),c=d(null),l=d(!1),i=d(null),s=P("jsonformEl"),u=P("chartElRef"),o=C(()=>{var t;return(t=T.value)==null?void 0:t.links.filter(e=>e.endpoint==="eoxhub_workspaces").length}),a=P("container"),m=d(!1),b=d(!1),g=d(!1),f=d([]),Z=C(()=>!b.value&&(!!i.value||!!n.value)&&!!s.value),{selectedStac:T,selectedCompareStac:$}=X(Y()),k=r.enableCompare?$:T,x=r.enableCompare?ee:ae,j=r.enableCompare?te:oe,D=r.enableCompare?ue:pe,q=C(()=>{var t;return j.value+((t=x.value)==null?void 0:t.id)});Ce({selectedStac:k,mapElement:x.value,jsonformEl:s,jsonformSchema:i,chartSpec:n,isProcessed:l,processResults:f,loading:m,isPolling:g});const G=()=>{f.value.forEach(t=>{var p;if(!t)return;let e="";typeof t=="string"?(e=t.includes("/")?t.split("/").pop()??"":t,e=e.includes("?")?e.split("?")[0]:e):e=((p=k.value)==null?void 0:p.id)+"_process_results.json",xe(e,t)})},V=async()=>{var I,N,O;const e=(R=>{var A,J;for(const K in R.properties)if((J=(A=R.properties[K])==null?void 0:A.options)!=null&&J.drawtools)return K})(i.value);if(e&&Array.isArray((I=s.value)==null?void 0:I.value[e])&&!((N=s.value)!=null&&N.value[e].length)){l.value=!1,n.value=null;return}const v=(O=s.value)==null?void 0:O.editor.validate();if(v!=null&&v.length){console.warn("[eodash] Form validation failed",v);return}f.value=[],await ve({jobs:D,selectedStac:k,jsonformEl:s,jsonformSchema:i,chartSpec:n,chartData:c,loading:m,isPolling:g,processResults:f,mapElement:x.value}),l.value=!0,o.value&&ge(D,j.value)};we(b,s,i,V);const Q=C(()=>{var e,p,v;const t={};return(e=n.value)!=null&&e.height||(t.height=Math.max((((p=a.value)==null?void 0:p.offsetHeight)??0)-(((v=s.value)==null?void 0:v.offsetHeight)??0),200)+"px"),t});return L(u,t=>{r.enableCompare?le.value=t:ce.value=t}),(t,e)=>(y(),B("div",_e,[fe(de,{"map-element":h(x),"enable-compare":r.enableCompare},null,8,["map-element","enable-compare"]),i.value?(y(),B("eox-jsonform",{key:q.value,ref_key:"jsonformEl",ref:s,".schema":i.value},null,40,Pe)):w("v-if",!0),l.value&&n.value?(y(),B("eox-chart",{key:1,ref_key:"chartElRef",ref:u,class:"chart",".spec":H(n.value),".dataValues":H(c.value),"onClick:item":e[0]||(e[0]=(...p)=>h(F)&&h(F)(...p)),style:ye(Q.value),".opt":r.vegaEmbedOptions},null,44,Be)):w("v-if",!0),me("div",Le,[Z.value?(y(),M(E,{key:0,loading:m.value,style:{"margin-right":"20px"},"append-icon":[h(se)],onClick:V,color:"primary"},{default:S(()=>e[1]||(e[1]=[z(" Execute ")])),_:1,__:[1]},8,["loading","append-icon"])):w("v-if",!0),f.value.length&&l.value&&!o.value?(y(),M(E,{key:1,color:"primary","append-icon":[h(re)],onClick:G},{default:S(()=>e[2]||(e[2]=[z(" Download ")])),_:1,__:[2]},8,["append-icon"])):w("v-if",!0)])],512))}},ra=W(Te,[["styles",[ke]]]);export{ra as default};
