import"./main.CGE7QkSM.js";import"./main.BerryGpl.js";import"./main.DAw3JAxj.js";import{_ as Y,s as Z,a as $,k as E,n as ee,aG as ae,aE as oe,bb as te,V as K,bc as se,a5 as re,bd as ne}from"./eo-dash.DJZ__uOH.js";import{c as ie,j as le,P as ce}from"./ProcessList-CZdEbk9z.C6d0w_W3.js";import{o as R,i as k,h as ue}from"./handling-C2b26Ari.BkGUaXF6.js";import{r as d,ai as F,f as x,a as _,o as m,D as pe,b as w,g as de,j as y,N as ve,au as H,c as M,w as S,I as z,p as U,aD as fe,m as G,P as me}from"./framework.CY4kwWiL.js";import{d as ye,k as be}from"./async-KQ6AhD1J.DirhnKZ1.js";import"./lit-element.Deg-YTNa.js";import"./addCommonStyleSheet.BpSJpEYw.js";import"./sequential.BHUe01AH.js";import"./orient2d.DArCjZZA.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.oNa9w_hR.js";import"./when.BR7zwNJC.js";import"./getElement.CdRlZPdn.js";import"./GeoJSON.Br7Jz3X5.js";import"./extent.CajDHjk1.js";import"./WKT.CRW3-4HE.js";import"./browser.COpcbqT-.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./item.CC2Khh23.js";import"./index-5m7x2kKX.DxZOvnNj.js";import"./VTooltip-B3WReGhh.DnYNvTml.js";import"./VOverlay-BQS8ZXPD.XedY0Ygs.js";import"./forwardRefs-Cq1T1PGt.DoTGMbGR.js";import"./transition-D6D2BhjW.CIzV-Suo.js";const he=({selectedStac:i,jsonformEl:r,jsonformSchema:c,chartSpec:l,isProcessed:n,processResults:s,loading:u,isPolling:o,mapElement:a})=>{const b=fe(ne);U(async()=>{((a==null?void 0:a.layers.length)??0)>1?await k({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:r,jsonformSchema:c,chartSpec:l,isProcessed:n,processResults:s,loading:u,isPolling:o}):b.once(async()=>{await k({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:r,jsonformSchema:c,chartSpec:l,isProcessed:n,loading:u,processResults:s,isPolling:o})})});const h=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";re(async(v,P)=>{v===h&&await k({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:i,jsonformEl:r,jsonformSchema:c,chartSpec:l,isProcessed:n,processResults:s,loading:u,isPolling:o})})};function ge(i,r,c,l){const n=async o=>{await l()},s=async()=>{await me(()=>{var o;(o=r.value)==null||o.addEventListener("change",n)})},u=()=>{var o;(o=r.value)==null||o.removeEventListener("change",n)};G(c,o=>{var a;i.value=((a=o==null?void 0:o.options)==null?void 0:a.execute)||!1}),U(()=>{G(i,async o=>{o?await s():u()},{immediate:!0})})}const xe="eox-chart{--background-color: transparent;padding-top:1em}eox-jsonform{padding:.7em;min-height:0px}",we={ref:"container",class:"pb-4"},Ce=[".schema"],ke=[".spec",".dataValues",".opt"],_e={class:"mt-4 text-right"},Pe={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(i){const r=d(null),c=d(null),l=d(!1),n=d(null),s=F("jsonformEl"),u=x(()=>{var t;return(t=B.value)==null?void 0:t.links.filter(e=>e.endpoint==="eoxhub_workspaces").length}),o=F("container"),a=d(!1),b=d(!1),h=d(!1),v=d([]),P=x(()=>!b.value&&(!!n.value||!!r.value)&&!!s.value),{selectedStac:B,selectedCompareStac:q}=Z($()),C=i.enableCompare?q:B,g=i.enableCompare?E:ee,L=i.enableCompare?ae:oe,T=i.enableCompare?ie:le,Q=x(()=>{var t;return L.value+((t=g.value)==null?void 0:t.id)});he({selectedStac:C,mapElement:g.value,jsonformEl:s,jsonformSchema:n,chartSpec:r,isProcessed:l,processResults:v,loading:a,isPolling:h});const W=()=>{v.value.forEach(t=>{var p;if(!t)return;let e="";typeof t=="string"?(e=t.includes("/")?t.split("/").pop()??"":t,e=e.includes("?")?e.split("?")[0]:e):e=((p=C.value)==null?void 0:p.id)+"_process_results.json",be(e,t)})},V=async()=>{var j,D,I;const e=(N=>{var O,A;for(const J in N.properties)if((A=(O=N.properties[J])==null?void 0:O.options)!=null&&A.drawtools)return J})(n.value);if(e&&Array.isArray((j=s.value)==null?void 0:j.value[e])&&!((D=s.value)!=null&&D.value[e].length)){l.value=!1,r.value=null;return}const f=(I=s.value)==null?void 0:I.editor.validate();if(f!=null&&f.length){console.warn("[eodash] Form validation failed",f);return}v.value=[],await ue({jobs:T,selectedStac:C,jsonformEl:s,jsonformSchema:n,chartSpec:r,chartData:c,loading:a,isPolling:h,processResults:v,mapElement:g.value}),l.value=!0,u.value&&ye(T,L.value)};ge(b,s,n,V);const X=x(()=>{var e,p,f;const t={};return(e=r.value)!=null&&e.height||(t.height=Math.max((((p=o.value)==null?void 0:p.offsetHeight)??0)-(((f=s.value)==null?void 0:f.offsetHeight)??0),200)+"px"),t});return(t,e)=>(m(),_("div",we,[pe(ce,{"map-element":y(g),"enable-compare":i.enableCompare},null,8,["map-element","enable-compare"]),n.value?(m(),_("eox-jsonform",{key:Q.value,ref_key:"jsonformEl",ref:s,".schema":n.value},null,40,Ce)):w("v-if",!0),l.value&&r.value?(m(),_("eox-chart",{key:1,class:"chart",".spec":H(r.value),".dataValues":H(c.value),"onClick:item":e[0]||(e[0]=(...p)=>y(R)&&y(R)(...p)),style:ve(X.value),".opt":i.vegaEmbedOptions},null,44,ke)):w("v-if",!0),de("div",_e,[P.value?(m(),M(K,{key:0,loading:a.value,style:{"margin-right":"20px"},"append-icon":[y(te)],onClick:V,color:"primary"},{default:S(()=>e[1]||(e[1]=[z(" Execute ")])),_:1,__:[1]},8,["loading","append-icon"])):w("v-if",!0),v.value.length&&l.value&&!u.value?(m(),M(K,{key:1,color:"primary","append-icon":[y(se)],onClick:W},{default:S(()=>e[2]||(e[2]=[z(" Download ")])),_:1,__:[2]},8,["append-icon"])):w("v-if",!0)])],512))}},oa=Y(Pe,[["styles",[xe]]]);export{oa as default};
