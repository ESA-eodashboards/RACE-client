import{s as X,a as Y,j as Z,k as E,K as ee,L as ae,M as oe,V as K,N as te,O as se,r as re,P as ne}from"./eo-dash.BJZRaexd.js";import{c as le,j as ie,_ as ce}from"./ProcessList-CAegpkmz.HfD-Q7X0.js";import{o as M,i as k,h as ue}from"./handling-BTgW6DPS.BA7U7AXP.js";import{u as de,d as ve}from"./async-B2-WW9U7.wKPyJakr.js";import{r as v,aM as R,f as w,a as _,o as y,D as pe,b as C,g as fe,j as m,N as ye,al as F,c as H,w as S,I as z,p as $,m as U,P as me}from"./framework.67QTkEGu.js";import"./item.BmAbL_Ub.js";import"./commonjsHelpers.Cpj98o6Y.js";import"./index-10iHeNjW.cdMT-ZnF.js";import"./VTooltip-BGN2-cvE.B3QxC-sK.js";import"./VOverlay-ScJnt2dG.81oJAPbT.js";import"./forwardRefs-8K3hNLhI.DhfaMK1l.js";import"./transition-DIeloNSD.CKZoTNTs.js";import"./utils.DSmV4XZg.js";const he=({selectedStac:l,jsonformEl:r,jsonformSchema:c,chartSpec:i,isProcessed:n,processResults:s,loading:u,isPolling:o,mapElement:a})=>{const h=se(ne);$(async()=>{((a==null?void 0:a.layers.length)??0)>1?await k({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:l,jsonformEl:r,jsonformSchema:c,chartSpec:i,isProcessed:n,processResults:s,loading:u,isPolling:o}):h.once(async()=>{await k({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:l,jsonformEl:r,jsonformSchema:c,chartSpec:i,isProcessed:n,loading:u,processResults:s,isPolling:o})})});const b=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";re(async(p,B)=>{p===b&&await k({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:l,jsonformEl:r,jsonformSchema:c,chartSpec:i,isProcessed:n,processResults:s,loading:u,isPolling:o})})};function be(l,r,c,i){const n=async o=>{await i()},s=async()=>{await me(()=>{var o;(o=r.value)==null||o.addEventListener("change",n)})},u=()=>{var o;(o=r.value)==null||o.removeEventListener("change",n)};U(c,o=>{var a;l.value=((a=o==null?void 0:o.options)==null?void 0:a.execute)||!1}),$(()=>{U(l,async o=>{o?await s():u()},{immediate:!0})})}const ge={ref:"container",class:"pb-4"},we=[".schema"],Ce=[".spec",".dataValues",".opt"],xe={class:"mt-4 text-right"},Je={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(l){const r=v(null),c=v(null),i=v(!1),n=v(null),s=R("jsonformEl"),u=w(()=>{var t;return(t=L.value)==null?void 0:t.links.filter(e=>e.endpoint==="eoxhub_workspaces").length}),o=R("container"),a=v(!1),h=v(!1),b=v(!1),p=v([]),B=w(()=>!h.value&&(!!n.value||!!r.value)&&!!s.value),{selectedStac:L,selectedCompareStac:q}=X(Y()),x=l.enableCompare?q:L,g=l.enableCompare?Z:E,P=l.enableCompare?ee:ae,T=l.enableCompare?le:ie,G=w(()=>{var t;return P.value+((t=g.value)==null?void 0:t.id)});he({selectedStac:x,mapElement:g.value,jsonformEl:s,jsonformSchema:n,chartSpec:r,isProcessed:i,processResults:p,loading:a,isPolling:b});const Q=()=>{p.value.forEach(t=>{var d;if(!t)return;let e="";typeof t=="string"?(e=t.includes("/")?t.split("/").pop()??"":t,e=e.includes("?")?e.split("?")[0]:e):e=((d=x.value)==null?void 0:d.id)+"_process_results.json",ve(e,t)})},V=async()=>{var j,N,O;const e=(D=>{var I,A;for(const J in D.properties)if((A=(I=D.properties[J])==null?void 0:I.options)!=null&&A.drawtools)return J})(n.value);if(e&&Array.isArray((j=s.value)==null?void 0:j.value[e])&&!((N=s.value)!=null&&N.value[e].length)){i.value=!1,r.value=null;return}const f=(O=s.value)==null?void 0:O.editor.validate();if(f!=null&&f.length){console.warn("[eodash] Form validation failed",f);return}p.value=[],await ue({jobs:T,selectedStac:x,jsonformEl:s,jsonformSchema:n,chartSpec:r,chartData:c,loading:a,isPolling:b,processResults:p,mapElement:g.value}),i.value=!0,u.value&&de(T,P.value)};be(h,s,n,V);const W=w(()=>{var e,d,f;const t={};return(e=r.value)!=null&&e.height||(t.height=Math.max((((d=o.value)==null?void 0:d.offsetHeight)??0)-(((f=s.value)==null?void 0:f.offsetHeight)??0),200)+"px"),t});return(t,e)=>(y(),_("div",ge,[pe(ce,{"map-element":m(g),"enable-compare":l.enableCompare},null,8,["map-element","enable-compare"]),n.value?(y(),_("eox-jsonform",{key:G.value,ref_key:"jsonformEl",ref:s,".schema":n.value},null,40,we)):C("v-if",!0),i.value&&r.value?(y(),_("eox-chart",{key:1,class:"chart",".spec":F(r.value),".dataValues":F(c.value),"onClick:item":e[0]||(e[0]=(...d)=>m(M)&&m(M)(...d)),style:ye(W.value),".opt":l.vegaEmbedOptions},null,44,Ce)):C("v-if",!0),fe("div",xe,[B.value?(y(),H(K,{key:0,loading:a.value,style:{"margin-right":"20px"},"append-icon":[m(oe)],onClick:V,color:"primary"},{default:S(()=>e[1]||(e[1]=[z(" Execute ")])),_:1,__:[1]},8,["loading","append-icon"])):C("v-if",!0),p.value.length&&i.value&&!u.value?(y(),H(K,{key:1,color:"primary","append-icon":[m(te)],onClick:Q},{default:S(()=>e[2]||(e[2]=[z(" Download ")])),_:1,__:[2]},8,["append-icon"])):C("v-if",!0)])],512))}};export{Je as default};
